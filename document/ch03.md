# ğŸŒ¹ node.jsì˜ express í”„ë ˆì„ì›Œí¬ ì´ìš©í•´ë³´ê¸° - RESTful API ì‚¬ìš©

---
- RESTëŠ” **R**epresentational **S**tate **T**ransferì˜ ì•½ìë¡œì„œ, WWWì™€ ê°™ì€ í•˜ì´í¼ë¯¸ë””ì–´ ì‹œìŠ¤í…œì„ ìœ„í•œ ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì³ ì¤‘ í•˜ë‚˜ì˜ í˜•ì‹ì´ë‹¤. 
- REST ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ í•˜ì—¬ê¸ˆ HTTP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ ì„œë²„ì˜ ì •ë³´ì— ì ‘ê·¼ê³¼ ë³€ê²½ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
---

## HTTP ë©”ì†Œë“œ
- REST ê¸°ë°˜ ì•„í‚¤í„±ì³ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë©”ì†Œë“œëŠ” 4ê°€ì§€ë¡œ ì•„ë˜ì™€ ê°™ë‹¤.
    1. GET - ì¡°íšŒ
    2. PUT - ìƒì„± ë° ì—…ë°ì´íŠ¸
    3. DELETE - ì œê±°
    4. POST - ìƒì„±

## Create DataBase
- JSON ê¸°ë°˜ì˜ ì‚¬ìš©ì ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³¸ë‹¤.
```JSON
{
    "first_user": {
        "password": "first_pass",
        "name": "abet"
    },
    "second_user":{
        "password": "second_pass",
        "name": "betty"
    }
}
```

## APT : GET
- ëª¨ë“    ìœ ì € ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶œë ¥í•˜ëŠ” GET APIë¥¼ ë§Œë“¤ì–´ë³¸ë‹¤.
- `user.json`íŒŒì¼ì„ ì½ì–´ì•¼í•˜ë‹ˆ fs ëª¨ë“ˆì„ ì‚¬ìš©í•œë‹¤.

> íŒŒì¼ ìœ„ì¹˜ : router/main.js
```js
module.exports = function(app, fs){
    app.get('/', function(req,res){
        res.render('index',{
            title : "Lake Page",
            length : 5
        })
    });

    app.get('/list', function(req,res){
       fs.readFile( __dirname + "/../data/" + "user.json" ,'utf8', function(err,data){
           console.log(data);
           res.end(data);
       }); 
    })
}
```
- `__dirname`ì€ í˜„ì¬ ëª¨ë“ˆì˜ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. router ëª¨ë“ˆì€ router í´ë”ì— ë“¤ì–´ìˆìœ¼ë‹ˆ data í´ë”ì— ì ‘ê·¼í•˜ë ¤ë©´ `/../`ë¥¼ ë¶™ì—¬ ë¨¼ì € ìƒìœ„ í´ë”ë¡œ ì ‘ê·¼í•´ì•¼í•œë‹¤.

- ì„œë²„ë¥¼ ì‹¤í–‰ í›„ `localhost:3000`ì— ì ‘ì†í•œë‹¤.

![GET_JSON](../image/ch03/getJSON.png)

## API : GET/getUser/:username
- íŠ¹ì • ìœ ì € usernameì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” GET APIë¥¼ ì‘ì„±í•œë‹¤.

> íŒŒì¼ ìœ„ì¹˜ : router/main.js

```js
app.get('/getUser/:username', function(req,res){
    fs.readFile( __dirname + "/../data/user.json","utf8", function(err, data){
        var users = JSON.parse(data);
        res.json(users[req.params.username]);
    });
});
```
- `/data/user.json`ì„ ì½ì€ í›„ user idë¥¼ ì°¾ì•„ì„œ ì¶œë ¥í•´ì¤€ë‹¤.
- `fs.readFile()`ë¡œ íŒŒì¼ì„ ì½ì—ˆì„ ì‹œì— text í˜•íƒœë¡œ ì½ì–´ì§€ê¸° ë•Œë¬¸ì— JSON.parse()ë¥¼ í•´ì¤˜ì•¼í•œë‹¤.

- ì„œë²„ ì‹¤í–‰ í›„ 'localhost:3000/getUser/first_user`ë¡œ ì ‘ì†í•œë‹¤.

![getUser](../image/ch03/getUser.png)


## API : POST addUser/:username
`body : {"password":"___","name":"___"}`

- HTTP íŒ¨í‚·ì„ ìš”ì²­í•˜ê³  ë¶„ì„í•˜ëŠ” í¬ë¡¬ í™•ì¥í”„ë¡œê·¸ë¨ì¸ `Result Client`ë¥¼ ì‚¬ìš©í•œë‹¤.

> íŒŒì¼ ìœ„ì¹˜ : router/main.js
```js
    app.post('/addUser/:username', function(req, res){

        var result = {  };
        var username = req.params.username;

        // CHECK REQ VALIDITY
        if(req.body["password"] || req.body["name"]){
            result["success"] = 0;
            result["error"] = "invalid request";
            res.json(result);
            return;
        }

        // LOAD DATA & CHECK DUPLICATION
        fs.readFile( __dirname + "/../data/user.json", 'utf8',  function(err, data){
            var users = JSON.parse(data);
            if(users[username]){
                // DUPLICATION FOUND
                result["success"] = 0;
                result["error"] = "duplicate";
                res.json(result);
                return;
            }

            // ADD TO DATA
            users[username] = req.body;

            // SAVE DATA
            fs.writeFile(__dirname + "/../data/user.json",
                         JSON.stringify(users, null, '\t'), "utf8", function(err, data){
                result = {"success": 1};
                res.json(result);
            })
        })
    });
```
- JSON í˜•íƒœê°€ ë‹¤ë¥´ë‹¤ë©´ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•˜ê³  ê°™ìœ¼ë©´ íŒŒì¼ì„ ì—´ì–´ì„œ usernameì˜ ì¤‘ë³µì„±ì„ í™•ì¸ í•œ í›„ JSON ë°ì´í„°ì— ì¶”ê°€í•˜ì—¬ ì €ì¥í•œë‹¤.

- `Result Client`ì—ì„œ `localhost:3000/addUser/newueser`ì— ì ‘ì†í•œë‹¤.

![newUser](../image/ch03/newUser.png)

